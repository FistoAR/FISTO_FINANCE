const r=document.getElementById("hrSalaryGenerateModal"),P=document.getElementById("hrSalaryModalClose"),_=document.getElementById("hrSalaryUpdateBtn");let s=null,n=null,l=null;function p(){const e=parseInt(document.getElementById("hrSalaryTotalLeaveDays").value)||0,a=parseInt(document.getElementById("hrSalaryPaidLeaveDays").value)||0,t=Math.max(0,e-a);return document.getElementById("hrSalaryDeductionDays").value=t.toString(),t}function C(e,a,t,d){if(!r)return;r.setAttribute("data-open","true"),s=e?.id||null,n=t,l=d,e&&(document.getElementById("hrSalaryEmpId").value=e.id||"",document.getElementById("hrSalaryEmpName").value=e.name||"",document.getElementById("hrSalaryDesignation").value=e.designation||"",document.getElementById("hrSalaryJobRole").value=e.jobRole||"");const o=document.getElementById("hrSalarySelectMonth");o&&t&&(o.value=t.toString()),a?(document.getElementById("hrSalaryBasic").value=a.basicSalary||"0",document.getElementById("hrSalaryTotalLeaveDays").value=a.totalLeaveDays||"0",document.getElementById("hrSalaryPaidLeaveDays").value=a.paidLeaveDays||"0",document.getElementById("hrSalaryDeductionAmount").value=a.deductionAmount||"0",document.getElementById("hrSalaryDeductionDays").value=a.totalDeductionDays||"0",document.getElementById("hrSalaryIncentive").value=a.incentive||"0",document.getElementById("hrSalaryBonus").value=a.bonus||"0",document.getElementById("hrSalaryMedical").value=a.medical||"0",document.getElementById("hrSalaryOtherAllowance").value=a.otherAllowance||"0"):e&&e.basicSalary&&(document.getElementById("hrSalaryBasic").value=e.basicSalary),p(),f(),L()}function m(){r&&(r.setAttribute("data-open","false"),T())}function T(){["hrSalaryEmpId","hrSalaryEmpName","hrSalaryDesignation","hrSalaryJobRole","hrSalaryBasic","hrSalaryTotalLeaveDays","hrSalaryPaidLeaveDays","hrSalaryDeductionAmount","hrSalaryDeductionDays","hrSalaryIncentive","hrSalaryBonus","hrSalaryMedical","hrSalaryOtherAllowance"].forEach(a=>{const t=document.getElementById(a);t&&(t.value="")}),s=null,n=null,l=null}function f(){if(!n||!l)return 0;const e=parseFloat(document.getElementById("hrSalaryBasic").value)||0,a=parseInt(document.getElementById("hrSalaryTotalLeaveDays").value)||0,t=parseInt(document.getElementById("hrSalaryPaidLeaveDays").value)||0,d=parseFloat(document.getElementById("hrSalaryDeductionAmount").value)||0,o=parseFloat(document.getElementById("hrSalaryIncentive").value)||0,M=parseFloat(document.getElementById("hrSalaryBonus").value)||0,w=parseFloat(document.getElementById("hrSalaryMedical").value)||0,A=parseFloat(document.getElementById("hrSalaryOtherAllowance").value)||0;function b(c,E){const F=new Date(E,c,0).getDate();let D=0;for(let i=1;i<=F;i++)new Date(E,c-1,i).getDay()===0&&D++;return D}const h=new Date(l,n,0).getDate(),v=b(n,l),S=h-v,u=Math.max(0,a-t);document.getElementById("hrSalaryDeductionDays").value=u.toString();let y;if(u>0){const c=e/S;y=e-c*u}else y=e;const I=y-d+o+M+w+A,g=document.getElementById("total_amount");return g&&(g.innerHTML=`
      <div style="display: flex; flex-direction: column; gap: 5px;">
        <span style="font-size: 0.9em; color: #666;">
          Month Days: ${h} | Payable: ${S} | Sundays: ${v} | Unpaid Leave: ${u}
        </span>
        <span style="font-size: 1.2em; font-weight: bold; color: #0052CC;">
          Total Amount: â‚¹ ${I.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}
        </span>
      </div>
    `),I}function L(){["hrSalaryBasic","hrSalaryTotalLeaveDays","hrSalaryPaidLeaveDays","hrSalaryDeductionAmount","hrSalaryIncentive","hrSalaryBonus","hrSalaryMedical","hrSalaryOtherAllowance"].forEach(a=>{const t=document.getElementById(a);t&&(t.removeEventListener("input",B),t.addEventListener("input",B))})}function B(){p(),f()}function x(){if(!s||!n||!l){window.CommonModal?window.CommonModal.error("Please select an employee and month","Validation Error"):alert("Please select an employee and month");return}const e=parseFloat(document.getElementById("hrSalaryBasic").value);if(!e||e<=0){window.CommonModal?window.CommonModal.error("Please enter a valid basic salary","Validation Error"):alert("Please enter a valid basic salary");return}const a={employee_id:s,month:n,year:l,basic_salary:e,total_leave_days:parseInt(document.getElementById("hrSalaryTotalLeaveDays").value)||0,paid_leave_days:parseInt(document.getElementById("hrSalaryPaidLeaveDays").value)||0,deduction_amount:parseFloat(document.getElementById("hrSalaryDeductionAmount").value)||0,total_deduction_days:parseInt(document.getElementById("hrSalaryDeductionDays").value)||0,incentive:parseFloat(document.getElementById("hrSalaryIncentive").value)||0,bonus:parseFloat(document.getElementById("hrSalaryBonus").value)||0,medical:parseFloat(document.getElementById("hrSalaryMedical").value)||0,other_allowance:parseFloat(document.getElementById("hrSalaryOtherAllowance").value)||0};document.dispatchEvent(new CustomEvent("saveSalaryRecord",{detail:a})),m()}P?.addEventListener("click",m);r?.addEventListener("click",e=>{e.target===r&&m()});_?.addEventListener("click",x);document.addEventListener("openGenerateModal",e=>{const{employee:a,salaryRecord:t,month:d,year:o}=e.detail;C(a,t,d,o)});document.addEventListener("astro:page-load",()=>{L()});
